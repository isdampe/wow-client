var fs = require("fs");
var path = require("path");
var await = require("../");

await.configDefer('yetanother', function (data, err) {
  if (err) {
    return {
      error: err
    };
  }
  else {
    return {
      returnVal: data
    };
  }
});

var testFunc = function (cb) {
  setImmediate(function () {
    cb(1, new Error('Custom Error'));
  });
}

await.async(function* (await, defer) {

  try {
    var data = await(yield fs.readFile(path.join(__dirname, "textFile"), defer));
    console.log(data.toString());

    yield await(2000);

    data = await(yield testFunc(defer.yetanother));
    console.log(data.toString());
  }
  catch (e) {
    console.log("Error catched: ", e.toString());
  }

});
